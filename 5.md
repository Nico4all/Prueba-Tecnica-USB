# Diseño e Implementación de una API REST con JWT

## 1. Implementación de una API REST con JSON Web Token (JWT)

Para la implementación de una API REST segura se utilizaría autenticación basada en **JSON Web Token (JWT)**. El proceso sería el siguiente:

### Autenticación
- Se implementa un endpoint `POST /auth/login` que recibe las credenciales del usuario.
- Si las credenciales son correctas, el servidor genera un **JWT firmado** que contiene información básica como el `id_usuario`, el `rol` y la fecha de expiración.
- El cliente almacena el token y lo envía en cada petición mediante el encabezado:
### Middleware de Seguridad
- Se crea un middleware que:
- Verifica la existencia del token.
- Valida la firma y la expiración.
- Extrae la información del usuario y su rol.
- Si el token no es válido se responde con `401 Unauthorized`.
- Si el usuario no tiene permisos suficientes se responde con `403 Forbidden`.

### Endpoints por cada tabla
- Se implementan endpoints REST para cada tabla del modelo:
- Ciudades
- Departamentos
- Empleados
- Motherboards
- Computadores
- Asignaciones
- AsignacionesV1
- Para cada recurso se definen operaciones CRUD según la necesidad.

### Endpoint adicional
- Se crea un endpoint extra para obtener la **información completa del empleado**, incluyendo departamento, ciudad y asignaciones, evitando múltiples consultas desde el frontend.

---

## 2. Implementación de la API para la tabla Empleado

Para la tabla **Empleado** se implementarían las siguientes peticiones:

- `GET /empleados`  
Permite obtener el listado de empleados con filtros opcionales.
- `GET /empleados/:codigo`  
Retorna la información de un empleado específico.
- `POST /empleados`  
Permite registrar un nuevo empleado.
- `PUT /empleados/:codigo`  
Permite actualizar la información del empleado.

### Sobre el uso de DELETE
No se recomienda eliminar físicamente un empleado debido a la relación con otras tablas (asignaciones, historial, auditoría).  
En su lugar se implementa un **borrado lógico**, utilizando un campo como `estado` o `fecha_retiro`.

Ejemplos:
- `PATCH /empleados/:codigo/retirar`
- `PATCH /empleados/:codigo/reactivar`

---

## 3. Validaciones necesarias para crear un empleado

Las validaciones se realizan en tres niveles:

### Validaciones de campos obligatorios y formato
- Campos obligatorios: código, nombre, apellido, cargo, fecha de ingreso y departamento.
- Tipos de datos correctos.
- Valores permitidos para el género.
- Salario y comisión no negativos.

### Validaciones de reglas del negocio
- La fecha de ingreso no puede ser anterior a la fecha de nacimiento.
- La fecha de retiro debe ser mayor o igual a la fecha de ingreso.
- Un empleado retirado no debe tener asignaciones activas.

### Validaciones de integridad referencial
- Verificar que el departamento exista.
- Verificar que el jefe exista si se asigna uno.
- Verificar que las ciudades de nacimiento y residencia existan.

**Implementación:**  
Estas validaciones se implementan en el backend usando librerías de validación y devolviendo errores claros con códigos HTTP adecuados (`400`, `409`).

---

## 4. Publicación de la API REST

La API se publicaría en un servidor utilizando contenedores Docker:

- Contenedor Backend: API REST.
- Contenedor Frontend: aplicación web.
- Contenedor Base de Datos: MySQL/MariaDB.
- Nginx como proxy inverso con HTTPS.

Se usarían variables de entorno para datos sensibles y se configurarían políticas de seguridad como CORS y rate limiting.

---

## 5. Lenguaje y tecnologías a utilizar

Se utilizaría **Node.js con TypeScript** por las siguientes razones:

- Manejo eficiente de operaciones asíncronas.
- Ideal para APIs REST con alta concurrencia.
- Gran ecosistema de librerías para JWT, validaciones y seguridad.
- TypeScript mejora la mantenibilidad y reduce errores.
- Fácil integración con frontend moderno y despliegue con Docker.

Para proyectos más grandes, se recomienda usar un framework como **NestJS** por su estructura y escalabilidad.